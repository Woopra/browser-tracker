{"version":3,"file":"wpt.min.js","sources":["../src/constants.js","../src/lib/utils.js","../src/lib/events.js","../src/lib/cookies.js","../src/lib/script.js","../src/lib/form.js","../src/globals.js","../src/woopra.js","../src/tracker.js","../src/lib/attach-events.js","../src/index.js"],"sourcesContent":["export const VERSION = 11;\nexport const ENDPOINT = 'www.woopra.com/track/';\nexport const XDM_PARAM_NAME = '__woopraid';\nexport const CAMPAIGN_KEYS = [\n  'campaign',\n  'content',\n  'id',\n  'medium',\n  'source',\n  'term'\n];\nexport const SECOND_LEVEL_TLDS = [\n  'com.au',\n  'net.au',\n  'org.au',\n  'co.hu',\n  'com.ru',\n  'ac.za',\n  'net.za',\n  'com.za',\n  'co.za',\n  'co.uk',\n  'org.uk',\n  'me.uk',\n  'net.uk'\n];\nexport const RANDOM_STRING_CHARS =\n  '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\nexport const MIN_PING_INTERVAL = 6000;\nexport const MAX_PING_INTERVAL = 60000;\nexport const URL_ID_REGEX = new RegExp(XDM_PARAM_NAME + '=([^&#]+)');\n\nexport const KEY_ACTION_PV = 'pv';\n\nexport const KEY_EVENT_CLICK = 'click';\nexport const KEY_EVENT_DOWNLOAD = 'download';\nexport const KEY_EVENT_MOUSEDOWN = 'mousedown';\nexport const KEY_EVENT_MOUSEMOVE = 'mousemove';\nexport const KEY_EVENT_OUTGOING = 'outgoing';\n\nexport const KEY_APP = 'app';\nexport const KEY_AUTO_DECORATE = 'auto_decorate';\nexport const KEY_CAMPAIGN_ONCE = 'campaign_once';\nexport const KEY_CONTEXT = 'context';\nexport const KEY_COOKIE_DOMAIN = 'cookie_domain';\nexport const KEY_COOKIE_EXPIRE = 'cookie_expire';\nexport const KEY_COOKIE_NAME = 'cookie_name';\nexport const KEY_COOKIE_PATH = 'cookie_path';\nexport const KEY_CROSS_DOMAIN = 'cross_domain';\nexport const KEY_DOMAIN = 'domain';\nexport const KEY_DOWNLOAD_PAUSE = 'download_pause';\nexport const KEY_DOWNLOAD_TRACKING = 'download_tracking';\nexport const KEY_HIDE_CAMPAIGN = 'hide_campaign';\nexport const KEY_HIDE_XDM_DATA = 'hide_xdm_data';\nexport const KEY_IDLE_THRESHOLD = 'idle_threshold';\nexport const KEY_IDLE_TIMEOUT = 'idle_timeout';\nexport const KEY_IGNORE_QUERY_URL = 'ignore_query_url';\nexport const KEY_IP = 'ip';\nexport const KEY_MAP_QUERY_PARAMS = 'map_query_params';\nexport const KEY_OUTGOING_IGNORE_SUBDOMAIN = 'outgoing_ignore_subdomain';\nexport const KEY_OUTGOING_PAUSE = 'outgoing_pause';\nexport const KEY_OUTGOING_TRACKING = 'outgoing_tracking';\nexport const KEY_PERSONALIZATION = 'personalization';\nexport const KEY_PING = 'ping';\nexport const KEY_PING_INTERVAL = 'ping_interval';\nexport const KEY_PROTOCOL = 'protocol';\nexport const KEY_SAVE_URL_HASH = 'save_url_hash';\nexport const KEY_THIRD_PARTY = 'third_party';\nexport const KEY_USE_COOKIES = 'use_cookies';\n","import { RANDOM_STRING_CHARS } from '../constants';\n\n/**\n * Generates a random 12 character string\n *\n * @return {String} Returns a random 12 character string\n */\nexport function randomString() {\n  let s = '';\n\n  for (let i = 0; i < 12; i++) {\n    const rnum = Math.floor(Math.random() * RANDOM_STRING_CHARS.length);\n    s += RANDOM_STRING_CHARS.substring(rnum, rnum + 1);\n  }\n\n  return s;\n}\n\nexport const noop = () => null;\n\nexport function isLeftClick(evt = window.event) {\n  const button =\n    (!isUndefined(evt.which) && evt.which === 1) ||\n    (!isUndefined(evt.button) && evt.button === 0);\n  return button && !evt.metaKey && !evt.altKey && !evt.ctrlKey && !evt.shiftKey;\n}\n\n/**\n * Helper to either query an element by id, or return element if passed\n * through options\n *\n * Supports searching by ids and classnames (or querySelector if browser supported)\n */\nexport function getElement(selector, options) {\n  const _options =\n    typeof selector === 'string' ? options || {} : selector || {};\n\n  if (_options.el) {\n    return _options.el;\n  } else if (typeof selector === 'string') {\n    if (document.querySelectorAll) {\n      return document.querySelectorAll(selector);\n    } else if (selector[0] === '#') {\n      return document.getElementById(selector.substr(1));\n    } else if (selector[0] === '.') {\n      return document.getElementsByClassName(selector.substr(1));\n    }\n  }\n}\n\n/**\n * Checks if string ends with suffix\n *\n * @param {string} str The haystack string\n * @param {string} suffix The needle\n * @return {boolean} True if needle was found in haystack\n */\nexport function endsWith(str, suffix) {\n  return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\n\n/**\n * Checks if string starts with prefix\n *\n * @param {string} str The haystack string\n * @param {string} prefix The needle\n * @return {boolean} True if needle was found in haystack\n */\nexport function startsWith(str, prefix) {\n  return str.indexOf(prefix) === 0;\n}\n\n/**\n * Checks if `value` is `undefined`\n *\n * @param {*} value The value to check.\n * @return {boolean} Returns `true` if `value` is `undefined`, else `false`.\n */\nexport function isUndefined(value) {\n  return value === undefined;\n}\n\nconst toString = Object.prototype.toString;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @param {*} value The value to check.\n * @return {boolean} Returns `true` if `value` is a function, else `false`.\n */\nexport function isFunction(value) {\n  if (typeof value === 'function') return true;\n  if (typeof value !== 'object') return false;\n\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  const tag = toString.call(value);\n  return (\n    tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object Proxy]'\n  );\n}\n","const handlers = {};\n\nexport function removeHandler(id, instance) {\n  handlers[id][instance] = null;\n}\n\nexport function attachEvent(element, type, callback) {\n  if (element.addEventListener) {\n    element.addEventListener(type, callback);\n  }\n}\n\nexport function on(parent, event, callback) {\n  const id = parent.instanceName;\n\n  if (!handlers[event]) {\n    handlers[event] = {};\n  }\n  handlers[event][id] = parent;\n\n  if (parent.__l) {\n    if (!parent.__l[event]) {\n      parent.__l[event] = [];\n    }\n    parent.__l[event].push(callback);\n  }\n}\n\nexport function fire(event) {\n  let handler;\n  const _event = handlers[event];\n  let _l;\n\n  if (_event) {\n    for (let id in _event) {\n      if (_event.hasOwnProperty(id)) {\n        handler = _event[id];\n        _l = handler && handler.__l;\n        if (_l && _l[event]) {\n          for (let i = 0; i < _l[event].length; i++) {\n            _l[event][i].apply(this, Array.prototype.slice.call(arguments, 1));\n          }\n        }\n      }\n    }\n  }\n}\n","/*\\\n|*|\n|*|  :: cookies.js ::\n|*|\n|*|  A complete cookies reader/writer framework with full unicode support.\n|*|\n|*|  Revision #1 - September 4, 2014\n|*|\n|*|  https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n|*|  https://developer.mozilla.org/User:fusionchess\n|*|\n|*|  This framework is released under the GNU Public License, version 3 or later.\n|*|  http://www.gnu.org/licenses/gpl-3.0-standalone.html\n|*|\n|*|  Syntaxes:\n|*|\n|*|  * docCookies.setItem(name, value[, end[, path[, domain[, secure]]]])\n|*|  * docCookies.getItem(name)\n|*|  * docCookies.removeItem(name[, path[, domain]])\n|*|  * docCookies.hasItem(name)\n|*|  * docCookies.keys()\n|*|\n\\*/\n\nexport function getItem(sKey) {\n  if (!sKey) {\n    return null;\n  }\n  return (\n    decodeURIComponent(\n      document.cookie.replace(\n        new RegExp(\n          '(?:(?:^|.*;)\\\\s*' +\n            encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') +\n            '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'\n        ),\n        '$1'\n      )\n    ) || null\n  );\n}\n\nexport function setItem(sKey, sValue, vEnd, sPath, sDomain, bSecure) {\n  if (!sKey || /^(?:expires|max\\-age|path|domain|secure)$/i.test(sKey)) {\n    return false;\n  }\n  let sExpires = '';\n  if (vEnd) {\n    switch (vEnd.constructor) {\n      case Number:\n        sExpires =\n          vEnd === Infinity\n            ? '; expires=Fri, 31 Dec 9999 23:59:59 GMT'\n            : '; max-age=' + vEnd;\n        break;\n      case String:\n        sExpires = '; expires=' + vEnd;\n        break;\n      case Date:\n        sExpires = '; expires=' + vEnd.toUTCString();\n        break;\n    }\n  }\n  document.cookie =\n    encodeURIComponent(sKey) +\n    '=' +\n    encodeURIComponent(sValue) +\n    sExpires +\n    (sDomain ? '; domain=' + sDomain : '') +\n    (sPath ? '; path=' + sPath : '') +\n    (bSecure ? '; secure' : '');\n  return true;\n}\n\nexport function removeItem(sKey, sPath, sDomain) {\n  if (!hasItem(sKey)) {\n    return false;\n  }\n  document.cookie =\n    encodeURIComponent(sKey) +\n    '=; expires=Thu, 01 Jan 1970 00:00:00 GMT' +\n    (sDomain ? '; domain=' + sDomain : '') +\n    (sPath ? '; path=' + sPath : '');\n  return true;\n}\n\nexport function hasItem(sKey) {\n  if (!sKey) {\n    return false;\n  }\n  return new RegExp(\n    '(?:^|;\\\\s*)' +\n      encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') +\n      '\\\\s*\\\\='\n  ).test(document.cookie);\n}\n\nexport function keys() {\n  const aKeys = document.cookie\n    .replace(/((?:^|\\s*;)[^\\=]+)(?=;|$)|^\\s*|\\s*(?:\\=[^;]*)?(?:\\1|$)/g, '')\n    .split(/\\s*(?:\\=[^;]*)?;\\s*/);\n  for (let nLen = aKeys.length, nIdx = 0; nIdx < nLen; nIdx++) {\n    aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]);\n  }\n  return aKeys;\n}\n","import { isUndefined, noop } from './utils';\n\nexport function removeScript(script) {\n  if (script && script.parentNode) {\n    script.parentNode.removeChild(script);\n  }\n}\n\nconst statusIsSuccessful = (readyState) =>\n  readyState === 4 || readyState === 'complete' || readyState === 'loaded';\n\nexport function loadScript(url, callback = noop) {\n  const script = document.createElement('script');\n\n  script.type = 'text/javascript';\n  script.async = true;\n\n  if (!isUndefined(script.onreadystatechange)) {\n    script.onreadystatechange = function onreadystatechange() {\n      if (statusIsSuccessful(this.readyState)) {\n        callback();\n        removeScript(script);\n      }\n    };\n  } else {\n    script.onload = () => {\n      callback();\n      removeScript(script);\n    };\n    script.onerror = () => {\n      removeScript(script);\n    };\n  }\n\n  script.src = url;\n\n  if (document.body) document.body.appendChild(script);\n  else document.head.appendChild(script);\n}\n","const TYPE_BUTTON = 'button';\nconst TYPE_SUBMIT = 'submit';\nconst TYPE_RESET = 'reset';\n\n// https://code.google.com/p/form-serialize/\n// modified to return an object\nexport function serializeForm(form, options = {}) {\n  if (!form || form.nodeName !== 'FORM') {\n    return;\n  }\n\n  const exclude = options.exclude || [];\n  const data = {};\n\n  for (let i = form.elements.length - 1; i >= 0; i = i - 1) {\n    if (\n      form.elements[i].name === '' ||\n      exclude.indexOf(form.elements[i].name) > -1\n    ) {\n      continue;\n    }\n    switch (form.elements[i].nodeName) {\n      case 'INPUT':\n        switch (form.elements[i].type) {\n          case 'text':\n          case 'hidden':\n          case TYPE_BUTTON:\n          case TYPE_RESET:\n          case TYPE_SUBMIT:\n            data[form.elements[i].name] = form.elements[i].value;\n            break;\n          case 'checkbox':\n          case 'radio':\n            if (form.elements[i].checked) {\n              data[form.elements[i].name] = form.elements[i].value;\n            }\n            break;\n          case 'file':\n            break;\n        }\n        break;\n      case 'TEXTAREA':\n        data[form.elements[i].name] = form.elements[i].value;\n        break;\n      case 'SELECT':\n        switch (form.elements[i].type) {\n          case 'select-one':\n            data[form.elements[i].name] = form.elements[i].value;\n            break;\n          case 'select-multiple':\n            for (\n              let j = form.elements[i].options.length - 1;\n              j >= 0;\n              j = j - 1\n            ) {\n              if (form.elements[i].options[j].selected) {\n                data[form.elements[i].name] = form.elements[i].options[j].value;\n              }\n            }\n            break;\n        }\n        break;\n      case 'BUTTON':\n        switch (form.elements[i].type) {\n          case TYPE_RESET:\n          case TYPE_SUBMIT:\n          case TYPE_BUTTON:\n            data[form.elements[i].name] = form.elements[i].value;\n            break;\n        }\n        break;\n    }\n  }\n  return data;\n}\n","import {\n  KEY_AUTO_DECORATE,\n  KEY_DOWNLOAD_PAUSE,\n  KEY_DOWNLOAD_TRACKING,\n  KEY_OUTGOING_IGNORE_SUBDOMAIN,\n  KEY_OUTGOING_PAUSE,\n  KEY_OUTGOING_TRACKING\n} from './constants';\n\nexport default {\n  [KEY_AUTO_DECORATE]: undefined,\n  [KEY_DOWNLOAD_PAUSE]: undefined,\n  [KEY_DOWNLOAD_TRACKING]: false,\n  [KEY_OUTGOING_IGNORE_SUBDOMAIN]: true,\n  [KEY_OUTGOING_PAUSE]: undefined,\n  [KEY_OUTGOING_TRACKING]: false\n};\n","import * as docCookies from './lib/cookies';\nimport { loadScript, removeScript } from './lib/script';\nimport {\n  CAMPAIGN_KEYS,\n  KEY_OUTGOING_IGNORE_SUBDOMAIN,\n  SECOND_LEVEL_TLDS,\n  XDM_PARAM_NAME\n} from './constants';\nimport { serializeForm } from './lib/form';\nimport { attachEvent, fire, on } from './lib/events';\nimport globals from './globals';\nimport {\n  endsWith,\n  getElement,\n  isLeftClick,\n  isUndefined,\n  randomString,\n  startsWith\n} from './lib/utils';\n\nconst Woopra = {};\n\nWoopra.docCookies = docCookies;\n\n/**\n * Wrapper for window.location to allow stubs in testing\n */\nWoopra.location = function location(property, value) {\n  // make sure property is valid\n  if (!isUndefined(window.location[property])) {\n    if (!isUndefined(value)) {\n      window.location[property] = value;\n    } else {\n      return window.location[property];\n    }\n  }\n};\n\nfunction getHostname() {\n  return Woopra.location('hostname');\n}\n\n/**\n * This exists to please the Safari gods. Sinon can't stub window in Safari.\n */\nWoopra.historyReplaceState =\n  window.history && window.history.replaceState\n    ? function historyReplaceState(data, title, url) {\n        return window.history.replaceState(data, title, url);\n      }\n    : function() {};\n\n/**\n * Hides any URL parameters by calling window.history.replaceState\n *\n * @param {Array} params A list of parameter prefixes that will be hidden\n * @return {String} Returns the new URL that will be used\n */\nWoopra.hideUrlParams = function hideUrlParams(params) {\n  const regex = new RegExp(\n    `[?&]+((?:${params.join('|')})[^=&]*)=([^&#]*)`,\n    'gi'\n  );\n  const href = Woopra.location('href').replace(regex, '');\n\n  Woopra.historyReplaceState(null, null, href);\n\n  return href;\n};\n\n/**\n * Retrieves the current URL parameters as an object\n *\n * @return {Object} An object for all of the URL parameters\n */\nWoopra.getUrlParams = function getUrlParams() {\n  const vars = {};\n  const href = Woopra.location('href');\n\n  if (href) {\n    href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {\n      vars[key] = decodeURIComponent(value.split('+').join(' '));\n    });\n  }\n\n  return vars;\n};\n\nWoopra.buildUrlParams = function buildUrlParams(params, prefix = '') {\n  const p = [];\n\n  if (isUndefined(params)) {\n    return params;\n  }\n\n  for (let key in params) {\n    if (params.hasOwnProperty(key)) {\n      if (\n        params[key] !== 'undefined' &&\n        params[key] !== 'null' &&\n        !isUndefined(params[key])\n      ) {\n        p.push(\n          `${prefix}${encodeURIComponent(key)}=${encodeURIComponent(\n            params[key]\n          )}`\n        );\n      }\n    }\n  }\n  return p.join('&');\n};\n\n/**\n * Parses the URL parameters for data beginning with a certain prefix\n *\n * @param {Function} method The callback method for each key found matching `prefix`\n * @param {string} prefix The prefix that the parameter should start with\n */\nWoopra.getCustomData = function getCustomData(method, prefix = 'wv_') {\n  const vars = Woopra.getUrlParams();\n\n  for (let i in vars) {\n    if (vars.hasOwnProperty(i)) {\n      const value = vars[i];\n\n      if (i.substring(0, prefix.length) === prefix) {\n        const key = i.substring(prefix.length);\n        method.call(this, key, value);\n      }\n    }\n  }\n};\n\n/**\n * Retrieves the current client domain name using the hostname\n * and returning the last two tokens with a `.` separator (domain + tld).\n *\n * This can be an issue if there is a second level domain\n */\nWoopra.getDomain = function getDomain(hostname = getHostname()) {\n  const domain = hostname.substring(\n    hostname.lastIndexOf('.', hostname.lastIndexOf('.') - 1) + 1\n  );\n\n  // check if domain is in list of second level domains, ignore if so\n  if (SECOND_LEVEL_TLDS.indexOf(domain) !== -1) {\n    return hostname.substring(\n      hostname.lastIndexOf('.', hostname.indexOf(domain) - 2) + 1\n    );\n  }\n\n  return domain;\n};\n\n/**\n * Returns the current hostname with 'www' stripped out\n */\nWoopra.getHostnameNoWww = function getHostnameNoWww() {\n  const hostname = getHostname();\n\n  if (hostname.indexOf('www.') === 0) {\n    return hostname.replace('www.', '');\n  }\n\n  return hostname;\n};\n\n/**\n * Determines if the current URL should be considered an outgoing URL\n */\nWoopra.isOutgoingLink = function isOutgoingLink(targetHostname) {\n  const currentHostname = getHostname();\n  const currentDomain = Woopra.getDomain(currentHostname);\n\n  return (\n    targetHostname !== currentHostname &&\n    targetHostname.replace(/^www\\./, '') !==\n      currentHostname.replace(/^www\\./, '') &&\n    (!globals[KEY_OUTGOING_IGNORE_SUBDOMAIN] ||\n      currentDomain !== Woopra.getDomain(targetHostname)) &&\n    !Woopra.startsWith(targetHostname, 'javascript') &&\n    targetHostname !== '' &&\n    targetHostname !== '#'\n  );\n};\n\nWoopra.hideCrossDomainId = function hideCrossDomainId() {\n  return Woopra.hideUrlParams([XDM_PARAM_NAME]);\n};\n\nWoopra.mapQueryParams = function mapQueryParams(mapping) {\n  const vars = Woopra.getUrlParams();\n  const params = {};\n\n  for (let key in mapping) {\n    const value = vars[key];\n    if (!isUndefined(value)) {\n      params[mapping[key]] = value;\n    }\n  }\n\n  return params;\n};\n\nWoopra.redirect = function redirect(link) {\n  Woopra.location('href', link);\n};\n\n/**\n * Parses current URL for parameters that start with either `utm_` or `woo_`\n * and have the keys `source`, `medium`, `content`, `campaign`, `term`\n *\n * @return {Object} Returns an object with campaign keys as keys\n */\nWoopra.getCampaignData = function getCampaignData() {\n  const vars = Woopra.getUrlParams();\n  const campaign = {};\n\n  for (let i = 0; i < CAMPAIGN_KEYS.length; i++) {\n    const key = CAMPAIGN_KEYS[i];\n    const value = vars[`utm_${key}`] || vars[`woo_${key}`];\n\n    if (!isUndefined(value)) {\n      campaign[`campaign_${key === 'campaign' ? 'name' : key}`] = value;\n    }\n  }\n\n  return campaign;\n};\n\n/**\n * Hides any campaign data (query params: wv_, woo_, utm_) from the URL\n * by using replaceState (if available)\n */\nWoopra.hideCampaignData = function hideCampaignData() {\n  return Woopra.hideUrlParams(['wv_', 'woo_', 'utm_']);\n};\n\nWoopra.leftClick = isLeftClick;\nWoopra.randomString = randomString;\nWoopra.getElement = getElement;\nWoopra.loadScript = loadScript;\nWoopra.removeScript = removeScript;\nWoopra.serializeForm = serializeForm;\nWoopra._on = on;\nWoopra._fire = fire;\nWoopra.attachEvent = attachEvent;\nWoopra.startsWith = startsWith;\nWoopra.endsWith = endsWith;\n\nexport default Woopra;\n","import { getElement, isFunction, isUndefined, randomString } from './lib/utils';\nimport {\n  ENDPOINT,\n  KEY_ACTION_PV,\n  KEY_APP,\n  KEY_AUTO_DECORATE,\n  KEY_CAMPAIGN_ONCE,\n  KEY_CONTEXT,\n  KEY_COOKIE_DOMAIN,\n  KEY_COOKIE_EXPIRE,\n  KEY_COOKIE_NAME,\n  KEY_COOKIE_PATH,\n  KEY_CROSS_DOMAIN,\n  KEY_DOMAIN,\n  KEY_DOWNLOAD_PAUSE,\n  KEY_DOWNLOAD_TRACKING,\n  KEY_EVENT_CLICK,\n  KEY_EVENT_DOWNLOAD,\n  KEY_EVENT_MOUSEMOVE,\n  KEY_EVENT_OUTGOING,\n  KEY_HIDE_CAMPAIGN,\n  KEY_HIDE_XDM_DATA,\n  KEY_IDLE_THRESHOLD,\n  KEY_IDLE_TIMEOUT,\n  KEY_IGNORE_QUERY_URL,\n  KEY_IP,\n  KEY_MAP_QUERY_PARAMS,\n  KEY_OUTGOING_IGNORE_SUBDOMAIN,\n  KEY_OUTGOING_PAUSE,\n  KEY_OUTGOING_TRACKING,\n  KEY_PERSONALIZATION,\n  KEY_PING,\n  KEY_PING_INTERVAL,\n  KEY_PROTOCOL,\n  KEY_SAVE_URL_HASH,\n  KEY_THIRD_PARTY,\n  KEY_USE_COOKIES,\n  MAX_PING_INTERVAL,\n  MIN_PING_INTERVAL,\n  URL_ID_REGEX,\n  VERSION,\n  XDM_PARAM_NAME\n} from './constants';\nimport { attachEvent, on, removeHandler } from './lib/events';\nimport Woopra from './woopra';\nimport globals from './globals';\n\nexport default class Tracker {\n  constructor(instanceName) {\n    this.visitorData = {};\n    this.sessionData = {};\n\n    this.options = {\n      [KEY_APP]: 'js-client',\n      [KEY_USE_COOKIES]: true,\n      [KEY_PING]: true,\n      [KEY_PING_INTERVAL]: 12000,\n      [KEY_IDLE_TIMEOUT]: 300000,\n      [KEY_IDLE_THRESHOLD]: 10000,\n      [KEY_DOWNLOAD_PAUSE]: globals[KEY_DOWNLOAD_PAUSE] || 200,\n      [KEY_OUTGOING_PAUSE]: globals[KEY_OUTGOING_PAUSE] || 200,\n      [KEY_DOWNLOAD_TRACKING]: false,\n      [KEY_OUTGOING_TRACKING]: false,\n      [KEY_OUTGOING_IGNORE_SUBDOMAIN]: true,\n      [KEY_HIDE_CAMPAIGN]: false,\n      [KEY_HIDE_XDM_DATA]: false,\n      [KEY_CAMPAIGN_ONCE]: false,\n      [KEY_THIRD_PARTY]: false,\n      [KEY_SAVE_URL_HASH]: true,\n      [KEY_CROSS_DOMAIN]: false,\n      [KEY_IGNORE_QUERY_URL]: false,\n      [KEY_MAP_QUERY_PARAMS]: {},\n      [KEY_COOKIE_NAME]: 'wooTracker',\n      [KEY_COOKIE_DOMAIN]: `.${Woopra.getHostnameNoWww()}`,\n      [KEY_COOKIE_PATH]: '/',\n      [KEY_COOKIE_EXPIRE]: new Date(\n        new Date().setDate(new Date().getDate() + 730)\n      ),\n      [KEY_PERSONALIZATION]: true\n    };\n\n    this.instanceName = instanceName || 'woopra';\n    this.idle = 0;\n    this.cookie = '';\n    this.last_activity = new Date();\n    this.loaded = false;\n    this.dirtyCookie = false;\n    this.sentCampaign = false;\n    this.version = VERSION;\n\n    if (instanceName && instanceName !== '') {\n      window[instanceName] = this;\n    }\n  }\n\n  init() {\n    this.__l = {};\n    this._processQueue('config');\n    this._setupCookie();\n    this._bindEvents();\n\n    // Otherwise loading indicator gets stuck until the every response\n    // in the queue has been received\n    setTimeout(() => this._processQueue(), 1);\n\n    this.loaded = true;\n\n    const callback = this.config('initialized');\n\n    if (isFunction(callback)) {\n      callback(this.instanceName);\n    }\n\n    // Safe to remove cross domain url parameter after setupCookie is called\n    // Should only need to be called once on load\n    if (this.config(KEY_HIDE_XDM_DATA)) {\n      Woopra.hideCrossDomainId();\n    }\n  }\n\n  /**\n   * Processes the tracker queue in case user tries to push events\n   * before tracker is ready.\n   */\n  _processQueue(type) {\n    var _wpt = window.__woo ? window.__woo[this.instanceName] : _wpt;\n    _wpt = window._w ? window._w[this.instanceName] : _wpt;\n\n    // if _wpt is undefined, means script was loaded asynchronously and\n    // there is no queue\n\n    if (_wpt && _wpt._e) {\n      const events = _wpt._e;\n      for (let i = 0; i < events.length; i++) {\n        const action = events[i];\n        if (\n          !isUndefined(action) &&\n          this[action[0]] &&\n          (isUndefined(type) || type === action[0])\n        ) {\n          this[action[0]].apply(this, Array.prototype.slice.call(action, 1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Sets up the tracking cookie\n   */\n  _setupCookie() {\n    const url_id = this.getUrlId();\n\n    this.cookie = this.getCookie();\n\n    // overwrite saved cookie if id is in url\n    if (url_id) {\n      this.cookie = url_id;\n    }\n\n    // Setup cookie\n    if (!this.cookie || this.cookie.length < 1) {\n      this.cookie = randomString();\n    }\n\n    Woopra.docCookies.setItem(\n      this.config(KEY_COOKIE_NAME),\n      this.cookie,\n      this.config(KEY_COOKIE_EXPIRE),\n      this.config(KEY_COOKIE_PATH),\n      this.config(KEY_COOKIE_DOMAIN)\n    );\n\n    this.dirtyCookie = true;\n  }\n\n  /**\n   * Binds some events to measure mouse and keyboard events\n   */\n  _bindEvents() {\n    on(this, KEY_EVENT_MOUSEMOVE, (e, l) => this.moved(e, l));\n    on(this, KEY_EVENT_DOWNLOAD, (url) => this.downloaded(url));\n    on(this, KEY_EVENT_OUTGOING, (url) => this.outgoing(url));\n    on(this, KEY_AUTO_DECORATE, (elem) => this.autoDecorate(elem));\n  }\n\n  /**\n   * Sets/gets values from dataStore depending on arguments passed\n   *\n   * @param dataStore Object The tracker property to read/write\n   * @param key String/Object Returns property object if key and value is undefined,\n   *      acts as a getter if only `key` is defined and a string, and\n   *      acts as a setter if `key` and `value` are defined OR if `key` is an object.\n   */\n  _dataSetter(dataStore, key, value) {\n    if (isUndefined(key)) {\n      return dataStore;\n    }\n\n    if (isUndefined(value)) {\n      if (typeof key === 'string') {\n        return dataStore[key];\n      }\n      if (typeof key === 'object') {\n        for (let i in key) {\n          if (key.hasOwnProperty(i)) {\n            if (Woopra.startsWith(i, 'cookie_')) {\n              this.dirtyCookie = true;\n            }\n            dataStore[i] = key[i];\n          }\n        }\n      }\n    } else {\n      if (Woopra.startsWith(key, 'cookie_')) {\n        this.dirtyCookie = true;\n      }\n      dataStore[key] = value;\n    }\n\n    return this;\n  }\n\n  /**\n   * Builds the correct tracking Url and performs an HTTP request\n   */\n  _push(options = {}) {\n    const types = [\n      ['visitorData', 'cv_'],\n      ['eventData', 'ce_'],\n      ['sessionData', 'cs_']\n    ];\n\n    const data = [];\n\n    const endpoint = this.getEndpoint(options.endpoint);\n\n    // Load custom visitor params from url\n    this.getVisitorUrlData();\n\n    if (this.config(KEY_HIDE_CAMPAIGN)) {\n      Woopra.hideCampaignData();\n    }\n\n    // push tracker config values\n    data.push(Woopra.buildUrlParams(this.getOptionParams()));\n\n    // push eventName if it exists\n    if (options.eventName) {\n      data.push(`event=${options.eventName}`);\n    }\n\n    // push close if no personalization\n    if (!this.config(KEY_PERSONALIZATION)) {\n      data.push('close=true');\n    }\n\n    for (let i = 0; i < types.length; i++) {\n      const [key, prefix] = types[i];\n      const params = options[key];\n\n      if (params) {\n        const urlParam = Woopra.buildUrlParams(params, prefix);\n\n        if (urlParam) {\n          data.push(urlParam);\n        }\n      }\n    }\n\n    if (this.config(KEY_CONTEXT)) {\n      try {\n        var contextData = JSON.stringify(this.config(KEY_CONTEXT));\n        data.push(`${KEY_CONTEXT}=${encodeURIComponent(contextData)}`);\n      } catch (e) {}\n    }\n\n    const queryString = data.join('&');\n    const scriptUrl = `${endpoint}?${queryString}`;\n\n    Woopra.loadScript(scriptUrl, options.callback);\n  }\n\n  getVisitorUrlData() {\n    Woopra.getCustomData.call(this, this.identify, 'wv_');\n  }\n\n  /*\n   * Returns the Woopra cookie string\n   */\n  getCookie() {\n    return Woopra.docCookies.getItem(this.config(KEY_COOKIE_NAME));\n  }\n\n  getProtocol() {\n    const protocol = this.config(KEY_PROTOCOL);\n    return protocol && protocol !== '' ? `${protocol}:` : '';\n  }\n\n  /**\n   * Generates a destination endpoint string to use depending on different\n   * configuration options\n   */\n  getEndpoint(path = '') {\n    const protocol = this.getProtocol();\n\n    if (this.config(KEY_THIRD_PARTY) && !this.config(KEY_DOMAIN)) {\n      throw new Error('Error: `domain` is not set.');\n    }\n\n    let thirdPartyPath = this.config(KEY_THIRD_PARTY)\n      ? `tp/${this.config(KEY_DOMAIN)}`\n      : '';\n\n    if (path && !Woopra.endsWith(path, '/')) {\n      path += '/';\n    }\n\n    if (thirdPartyPath && !Woopra.startsWith(path, '/')) {\n      thirdPartyPath += '/';\n    }\n\n    return `${protocol}//${ENDPOINT}${thirdPartyPath}${path}`;\n  }\n\n  /**\n   * Sets configuration options\n   */\n  config(key, value) {\n    const data = this._dataSetter(this.options, key, value);\n\n    // dataSetter returns `this` when it is used as a setter\n    if (data === this) {\n      // clamp ping interval\n      this.options[KEY_PING_INTERVAL] = Math.max(\n        MIN_PING_INTERVAL,\n        Math.min(this.options[KEY_PING_INTERVAL], MAX_PING_INTERVAL)\n      );\n\n      // set script wide variables for events that are bound on script load\n      // since we shouldn't bind per tracker instance\n      globals[KEY_OUTGOING_TRACKING] = this.options[KEY_OUTGOING_TRACKING];\n      globals[KEY_OUTGOING_PAUSE] = this.options[KEY_OUTGOING_PAUSE];\n      globals[KEY_DOWNLOAD_TRACKING] = this.options[KEY_DOWNLOAD_TRACKING];\n      globals[KEY_DOWNLOAD_PAUSE] = this.options[KEY_DOWNLOAD_PAUSE];\n      globals[KEY_AUTO_DECORATE] =\n        isUndefined(globals[KEY_AUTO_DECORATE]) &&\n        this.options[KEY_CROSS_DOMAIN]\n          ? this.options[KEY_CROSS_DOMAIN]\n          : globals[KEY_AUTO_DECORATE];\n      globals[KEY_OUTGOING_IGNORE_SUBDOMAIN] = this.options[\n        KEY_OUTGOING_IGNORE_SUBDOMAIN\n      ];\n\n      if (this.dirtyCookie && this.loaded) {\n        this._setupCookie();\n      }\n    }\n\n    return data;\n  }\n\n  /**\n   * Use to attach custom visit data that doesn't stick to visitor\n   * ** Not in use yet\n   */\n  visit(key, value) {\n    return this._dataSetter(this.sessionData, key, value);\n  }\n\n  /**\n   * Attach custom visitor data\n   */\n  identify(key, value) {\n    return this._dataSetter(this.visitorData, key, value);\n  }\n\n  /**\n   * Generic method to call any tracker method\n   */\n  call(funcName) {\n    if (isFunction(this[funcName])) {\n      this[funcName].apply(this, Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Send an event to tracking servr\n   */\n  track(name, options) {\n    let eventData = {};\n    let eventName = '';\n    let hash;\n    let callback;\n    let _cb = arguments[arguments.length - 1];\n\n    if (typeof _cb === 'function') {\n      callback = _cb;\n    }\n\n    // Load campaign params (load first to allow overrides)\n    if (!this.config(KEY_CAMPAIGN_ONCE) || !this.sentCampaign) {\n      eventData = { ...eventData, ...Woopra.getCampaignData() };\n      this.sentCampaign = true;\n    }\n\n    // Load query params mapping into Woopra event\n    eventData = {\n      ...eventData,\n      ...Woopra.mapQueryParams(this.config(KEY_MAP_QUERY_PARAMS))\n    };\n\n    if (isFunction(_cb)) {\n      callback = _cb;\n    }\n\n    // Track default: pageview\n    if (isUndefined(name) || name === callback) {\n      eventName = KEY_ACTION_PV;\n    }\n    // Track custom events\n    else if (isUndefined(options) || options === callback) {\n      if (typeof name === 'string') {\n        eventName = name;\n      }\n      if (typeof name === 'object') {\n        if (name.name && name.name === KEY_ACTION_PV) {\n          eventName = KEY_ACTION_PV;\n        }\n\n        this._dataSetter(eventData, name);\n      }\n    }\n    // Track custom events in format of name,object\n    else {\n      this._dataSetter(eventData, options);\n      eventName = name;\n    }\n\n    // Add some defaults for pageview\n    if (eventName === KEY_ACTION_PV) {\n      eventData.url = eventData.url || this.getPageUrl();\n      eventData.title = eventData.title || this.getPageTitle();\n      eventData.domain = eventData.domain || this.getDomainName();\n      eventData.uri = eventData.uri || this.getURI();\n\n      if (this.config(KEY_SAVE_URL_HASH)) {\n        hash = eventData.hash || this.getPageHash();\n        if (hash !== '' && hash !== '#') {\n          eventData.hash = hash;\n        }\n      }\n    }\n\n    this._push({\n      endpoint: 'ce',\n      visitorData: this.visitorData,\n      sessionData: this.sessionData,\n      eventName,\n      eventData,\n      callback\n    });\n\n    this.startPing();\n  }\n\n  /**\n   * Tracks a single form and then resubmits it\n   */\n  trackForm(eventName = 'Tracked Form', selector, options) {\n    let els;\n    const _options =\n      typeof selector === 'string' ? options || {} : selector || {};\n\n    const bindEl = (el, ev, props, opts) => {\n      attachEvent(el, 'submit', (e) => {\n        this.trackFormHandler(e, el, ev, _options);\n      });\n    };\n\n    if (_options.elements) {\n      els = _options.elements;\n    } else {\n      els = getElement(selector, _options);\n    }\n\n    // attach event if form was found\n    if (els && els.length > 0) {\n      for (let i in els) {\n        bindEl(els[i], eventName, _options);\n      }\n    }\n  }\n\n  trackFormHandler(e, el, eventName, options = {}) {\n    let trackFinished = false;\n\n    if (!el.getAttribute('data-tracked')) {\n      const data = Woopra.serializeForm(el, options);\n\n      if (isFunction(options.identify)) {\n        const personData = options.identify(data) || {};\n\n        if (personData) {\n          this.identify(personData);\n        }\n      }\n\n      if (options.noSubmit) {\n        this.track(eventName, data, () => {\n          if (isFunction(options.callback)) {\n            options.callback(data);\n          }\n        });\n      } else {\n        e.preventDefault();\n        e.stopPropagation();\n\n        el.setAttribute('data-tracked', 1);\n\n        // submit the form if the reply takes less than 250ms\n        this.track(eventName, data, () => {\n          trackFinished = true;\n\n          if (isFunction(options.callback)) {\n            options.callback(data);\n          }\n\n          el.submit();\n        });\n\n        // set timeout to resubmit to be a hard 250ms\n        // so even if woopra does not reply it will still\n        // submit the form\n        setTimeout(() => {\n          if (!trackFinished) {\n            el.submit();\n          }\n        }, 250);\n      }\n    }\n  }\n\n  /**\n   * Tracks clicks\n   *\n   * @param {String} eventName The name of the event to track\n   * @param {String} selector The id of element to track\n   * @param {Object} properties Any event properties to track with\n   * @param {Object} options (Optional) Options object\n   * @param {Array} options.elements Supports an array of elements (jQuery object)\n   * @param {Boolean} options.noNav (Default: false) If true, will only perform the track event and let the click event bubble up\n   */\n  trackClick(eventName = 'Item Clicked', selector, properties, options = {}) {\n    let els = [];\n\n    const bindEl = (el, ev, props, opts) => {\n      attachEvent(el, KEY_EVENT_CLICK, (e) => {\n        this.trackClickHandler(e, el, ev, props, opts);\n      });\n    };\n\n    /**\n     * Support an array of elements\n     */\n    if (options.elements) {\n      els = options.elements;\n    } else {\n      els = getElement(selector, options);\n    }\n\n    if (els) {\n      for (let i = 0; i < els.length; i++) {\n        bindEl(els[i], eventName, properties, options);\n      }\n    }\n  }\n\n  trackClickHandler(e, el, eventName, properties, options) {\n    let trackFinished = false;\n\n    if (!el.getAttribute('data-tracked')) {\n      if (options.noNav) {\n        this.track(eventName, properties);\n      } else {\n        e.preventDefault();\n\n        el.setAttribute('data-tracked', 1);\n\n        this.track(eventName, properties, () => {\n          trackFinished = true;\n\n          if (isFunction(options.callback)) {\n            options.callback();\n          }\n\n          el.click();\n        });\n\n        setTimeout(() => {\n          if (!trackFinished) {\n            el.click();\n          }\n        }, 250);\n      }\n    }\n  }\n\n  startPing() {\n    if (isUndefined(this.pingInterval)) {\n      this.pingInterval = setInterval(() => {\n        this.ping();\n      }, this.config(KEY_PING_INTERVAL));\n    }\n  }\n\n  stopPing() {\n    if (!isUndefined(this.pingInterval)) {\n      clearInterval(this.pingInterval);\n      delete this.pingInterval;\n    }\n  }\n\n  /**\n   * Pings tracker with visitor info\n   */\n  ping() {\n    if (this.config(KEY_PING) && this.idle < this.config(KEY_IDLE_TIMEOUT)) {\n      this._push({\n        endpoint: 'ping'\n      });\n    } else {\n      this.stopPing();\n    }\n\n    const now = new Date();\n    if (now - this.last_activity > this.config(KEY_IDLE_THRESHOLD)) {\n      this.idle = now - this.last_activity;\n    }\n\n    return this;\n  }\n\n  /**\n   * Pushes visitor data to server without sending an event\n   */\n  push(callback) {\n    this._push({\n      endpoint: 'identify',\n      visitorData: this.visitorData,\n      sessionData: this.sessionData,\n      callback\n    });\n    return this;\n  }\n\n  /**\n   * synchronous sleep\n   */\n  sleep() {\n    // Why does this exist?\n  }\n\n  // User Action tracking and event handlers\n\n  /**\n   * Clicks\n   */\n\n  /**\n   * Measure when the user last moved their mouse to update idle state\n   */\n  moved(e, last_activity) {\n    this.last_activity = last_activity;\n    this.idle = 0;\n  }\n\n  downloaded(url) {\n    this.track(KEY_EVENT_DOWNLOAD, {\n      url\n    });\n  }\n\n  outgoing(url) {\n    this.track(KEY_EVENT_OUTGOING, {\n      url\n    });\n  }\n\n  /**\n   * Event handler for decorating an element with a URL (for now only\n   * anchor tags)\n   */\n  autoDecorate(elem) {\n    const xdm = this.config(KEY_CROSS_DOMAIN);\n\n    if (!xdm) return;\n\n    let canDecorate;\n\n    if (typeof xdm === 'string') {\n      canDecorate = elem.hostname.indexOf(xdm) > -1;\n    } else if (xdm.push) {\n      for (let i = 0; i < xdm.length; i++) {\n        if (elem.hostname.indexOf(xdm[i]) !== -1) {\n          canDecorate = true;\n          break;\n        }\n      }\n    }\n\n    if (canDecorate) {\n      const decorated = this.decorate(elem);\n\n      if (decorated) {\n        elem.href = decorated;\n        // bind an event handler on mouseup to remove the url\n      }\n    }\n  }\n\n  /**\n   * Resets cookie\n   */\n  reset() {\n    Woopra.docCookies.removeItem(\n      this.config(KEY_COOKIE_NAME),\n      this.config(KEY_COOKIE_PATH),\n      this.config(KEY_COOKIE_DOMAIN)\n    );\n    this.cookie = null;\n    this._setupCookie();\n  }\n\n  /**\n   * Decorates a given URL with a __woopraid query param with value of\n   * the current cookie\n   */\n  decorate(url) {\n    let el;\n    let query;\n    let pathname;\n    let host;\n\n    if (typeof url === 'string') {\n      el = document.createElement('a');\n      el.href = url;\n      query = el.search ? '&' : '?';\n    } else if (url && url.href) {\n      el = url;\n    }\n\n    if (el) {\n      query = el.search ? '&' : '?';\n      pathname =\n        el.pathname && el.pathname.charAt(0) === '/'\n          ? el.pathname\n          : '/' + el.pathname;\n\n      host =\n        el.hostname +\n        (el.port && el.port !== '' && el.port !== '80' && el.port !== '0'\n          ? ':' + el.port\n          : '');\n\n      return `${el.protocol}//${host}${pathname}${el.search}${query}${XDM_PARAM_NAME}=${this.cookie}${el.hash}`;\n    }\n  }\n\n  /**\n   * Undecorates a URL with __woopraid query param\n   */\n  undecorate(url) {\n    const regex = new RegExp(`[?&]+(?:${XDM_PARAM_NAME})=([^&#]*)`, 'gi');\n    let _url = url;\n\n    if (url && url.href) {\n      _url = url.href;\n    }\n\n    if (_url) {\n      return _url.replace(regex, '');\n    }\n  }\n\n  getPageUrl() {\n    if (this.config(KEY_IGNORE_QUERY_URL)) {\n      return Woopra.location('pathname');\n    }\n    return `${Woopra.location('pathname')}${Woopra.location('search')}`;\n  }\n\n  getPageHash() {\n    return Woopra.location('hash');\n  }\n\n  getPageTitle() {\n    return document.getElementsByTagName('title').length === 0\n      ? ''\n      : document.getElementsByTagName('title')[0].innerHTML;\n  }\n\n  getDomainName() {\n    return Woopra.location('hostname');\n  }\n\n  getURI() {\n    return Woopra.location('href');\n  }\n\n  /**\n   * Retrieves a Woopra unique id from a URL's query param (__woopraid)\n   *\n   * @param {String} href The full URL to extract from\n   */\n  getUrlId(href = Woopra.location('href')) {\n    const matches = href.match(URL_ID_REGEX);\n\n    if (matches && matches[1]) {\n      return matches[1];\n    }\n  }\n\n  getOptionParams() {\n    // default params\n    const o = {\n      project: this.config(KEY_DOMAIN) || Woopra.getHostnameNoWww(),\n      instance: this.instanceName,\n      meta: Woopra.docCookies.getItem('wooMeta') || '',\n      screen: `${window.screen.width}x${window.screen.height}`,\n      language:\n        window.navigator.browserLanguage || window.navigator.language || '',\n      app: this.config(KEY_APP),\n      referer: document.referrer\n    };\n\n    if (!this.config(KEY_DOMAIN)) {\n      o._warn = 'no_domain';\n\n      if (Woopra.getHostnameNoWww() !== Woopra.getDomain()) {\n        o._warn += ',domain_mismatch';\n      }\n    }\n\n    // set cookie if configured\n    if (this.config(KEY_USE_COOKIES)) {\n      o.cookie = this.getCookie() || this.cookie;\n    }\n\n    // set ip if configured\n    if (this.config(KEY_IP)) {\n      o.ip = this.config(KEY_IP);\n    }\n\n    return o;\n  }\n\n  /**\n   * Stop ping timers and cleanup any globals.  Shouldn't really\n   * be needed by clients.\n   */\n  dispose() {\n    this.stopPing();\n\n    for (let id in this.__l) {\n      if (this.__l.hasOwnProperty(id)) {\n        removeHandler(id, this.instanceName);\n      }\n    }\n    this.__l = null;\n\n    // cleanup global\n    if (!isUndefined(window[this.instanceName])) {\n      try {\n        delete window[this.instanceName];\n      } catch (e) {\n        window[this.instanceName] = undefined;\n      }\n    }\n  }\n}\n","import {\n  KEY_AUTO_DECORATE,\n  KEY_DOWNLOAD_PAUSE,\n  KEY_DOWNLOAD_TRACKING,\n  KEY_EVENT_CLICK,\n  KEY_EVENT_DOWNLOAD,\n  KEY_EVENT_MOUSEDOWN,\n  KEY_EVENT_MOUSEMOVE,\n  KEY_EVENT_OUTGOING,\n  KEY_OUTGOING_PAUSE,\n  KEY_OUTGOING_TRACKING\n} from '../constants';\nimport globals from '../globals';\nimport Woopra from '../woopra';\nimport { isUndefined } from './utils';\n\nconst on = Woopra.attachEvent;\nconst fire = Woopra._fire;\n\n// attaches any events\n// needs to be handled here, instead of in a tracking instance because\n// these events should only be fired once on a page\nexport default function attachEvents() {\n  on(document, KEY_EVENT_MOUSEDOWN, (e) => {\n    let cElem;\n\n    fire(KEY_EVENT_MOUSEMOVE, e, new Date());\n\n    if (globals[KEY_AUTO_DECORATE]) {\n      cElem = e.srcElement || e.target;\n      while (!isUndefined(cElem) && cElem !== null) {\n        if (cElem.tagName && cElem.tagName.toLowerCase() === 'a') {\n          break;\n        }\n        cElem = cElem.parentNode;\n      }\n      if (!isUndefined(cElem) && cElem !== null) {\n        fire(KEY_AUTO_DECORATE, cElem);\n      }\n    }\n  });\n\n  on(document, KEY_EVENT_CLICK, (e) => {\n    const ignoreTarget = '_blank';\n    let link, _download;\n\n    let cElem = e.srcElement || e.target;\n\n    if (Woopra.leftClick(e)) {\n      fire(KEY_EVENT_CLICK, e, cElem);\n    }\n\n    if (globals[KEY_DOWNLOAD_TRACKING] || globals[KEY_OUTGOING_TRACKING]) {\n      // searches for an anchor element\n      while (!isUndefined(cElem) && cElem !== null) {\n        if (cElem.tagName && cElem.tagName.toLowerCase() === 'a') {\n          break;\n        }\n        cElem = cElem.parentNode;\n      }\n\n      if (\n        !isUndefined(cElem) &&\n        cElem !== null &&\n        !cElem.getAttribute('data-woopra-tracked')\n      ) {\n        link = cElem;\n        _download = link.pathname.match(\n          /(?:doc|dmg|eps|svg|xls|xlsx|ppt|pdf|zip|txt|vsd|vxd|js|css|rar|exe|msi|wma|mov|avi|wmv|mp3|mp4|m4v)($|\\&)/\n        );\n\n        if (globals[KEY_DOWNLOAD_TRACKING] && _download) {\n          fire(KEY_EVENT_DOWNLOAD, link.href);\n\n          if (link.target !== ignoreTarget && Woopra.leftClick(e)) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            link.setAttribute('data-woopra-tracked', true);\n\n            setTimeout(() => {\n              link.click();\n            }, globals[KEY_DOWNLOAD_PAUSE]);\n          }\n        }\n        // Make sure\n        // * outgoing tracking is enabled\n        // * this URL does not match a download URL (doesn't end\n        //   in a binary file extension)\n        // * not ignoring subdomains OR link hostname is not a partial\n        //   match of current hostname (to check for subdomains),\n        // * hostname is not empty\n        if (\n          globals[KEY_OUTGOING_TRACKING] &&\n          !_download &&\n          Woopra.isOutgoingLink(link.hostname)\n        ) {\n          fire(KEY_EVENT_OUTGOING, link.href);\n\n          if (link.target !== ignoreTarget && Woopra.leftClick(e)) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            link.setAttribute('data-woopra-tracked', true);\n\n            setTimeout(() => {\n              link.click();\n            }, globals[KEY_OUTGOING_PAUSE]);\n          }\n        }\n      }\n    }\n  });\n\n  on(document, KEY_EVENT_MOUSEMOVE, (e) => {\n    fire(KEY_EVENT_MOUSEMOVE, e, new Date());\n  });\n}\n","import Tracker from './tracker';\nimport { isFunction, isUndefined } from './lib/utils';\nimport Woopra from './woopra';\nimport attachEvents from './lib/attach-events';\n\nwindow.WoopraTracker = Tracker;\nwindow.WoopraLoadScript = Woopra.loadScript;\n\nattachEvents();\n\nif (!isUndefined(window.exports)) {\n  Woopra.Tracker = Tracker;\n  window.exports.Woopra = Woopra;\n\n  if (isFunction(window.woopraLoaded)) {\n    window.woopraLoaded();\n    window.woopraLoaded = null;\n  }\n}\n\n// Initialize instances & preloaded settings/events\nvar _queue = window.__woo || window._w;\nif (!isUndefined(_queue)) {\n  for (var name in _queue) {\n    if (_queue.hasOwnProperty(name)) {\n      var instance = new Tracker(name);\n      instance.init();\n\n      // DO NOT REMOVE\n      // compatibility with old tracker and chat\n      if (isUndefined(window.woopraTracker)) {\n        window.woopraTracker = instance;\n      }\n    }\n  }\n}\n"],"names":["XDM_PARAM_NAME","CAMPAIGN_KEYS","SECOND_LEVEL_TLDS","RANDOM_STRING_CHARS","URL_ID_REGEX","RegExp","KEY_ACTION_PV","KEY_EVENT_CLICK","KEY_EVENT_DOWNLOAD","KEY_EVENT_MOUSEMOVE","KEY_EVENT_OUTGOING","KEY_AUTO_DECORATE","KEY_CAMPAIGN_ONCE","KEY_CONTEXT","KEY_COOKIE_DOMAIN","KEY_COOKIE_EXPIRE","KEY_COOKIE_NAME","KEY_COOKIE_PATH","KEY_CROSS_DOMAIN","KEY_DOMAIN","KEY_DOWNLOAD_PAUSE","KEY_DOWNLOAD_TRACKING","KEY_HIDE_CAMPAIGN","KEY_HIDE_XDM_DATA","KEY_IDLE_THRESHOLD","KEY_IDLE_TIMEOUT","KEY_IGNORE_QUERY_URL","KEY_MAP_QUERY_PARAMS","KEY_OUTGOING_IGNORE_SUBDOMAIN","KEY_OUTGOING_PAUSE","KEY_OUTGOING_TRACKING","KEY_PERSONALIZATION","KEY_PING","KEY_PING_INTERVAL","KEY_SAVE_URL_HASH","KEY_THIRD_PARTY","KEY_USE_COOKIES","randomString","s","i","rnum","Math","floor","random","length","substring","noop","getElement","selector","options","_options","el","document","querySelectorAll","getElementById","substr","getElementsByClassName","isUndefined","value","undefined","toString","Object","prototype","isFunction","tag","call","handlers","attachEvent","element","type","callback","addEventListener","on","parent","event","id","instanceName","__l","push","hasItem","sKey","encodeURIComponent","replace","test","cookie","decodeURIComponent","sValue","vEnd","sPath","sDomain","bSecure","sExpires","constructor","Number","Infinity","String","Date","toUTCString","aKeys","split","nLen","nIdx","removeScript","script","parentNode","removeChild","Woopra","getHostname","location","docCookies","property","window","historyReplaceState","history","replaceState","data","title","url","hideUrlParams","params","regex","join","href","getUrlParams","vars","m","key","buildUrlParams","prefix","p","hasOwnProperty","getCustomData","method","this","getDomain","hostname","domain","lastIndexOf","indexOf","getHostnameNoWww","isOutgoingLink","targetHostname","currentHostname","currentDomain","globals","startsWith","hideCrossDomainId","mapQueryParams","mapping","redirect","link","getCampaignData","campaign","hideCampaignData","leftClick","evt","which","button","metaKey","altKey","ctrlKey","shiftKey","loadScript","createElement","async","onreadystatechange","onload","onerror","readyState","statusIsSuccessful","src","body","appendChild","head","serializeForm","form","nodeName","exclude","elements","name","checked","j","selected","_on","_fire","handler","_l","_event","apply","Array","slice","arguments","str","endsWith","suffix","Tracker","visitorData","sessionData","setDate","getDate","idle","last_activity","loaded","dirtyCookie","sentCampaign","version","init","_processQueue","_setupCookie","_bindEvents","setTimeout","_this","config","_wpt","__woo","_w","_e","events","action","url_id","getUrlId","getCookie","setItem","e","l","_this2","moved","downloaded","outgoing","elem","autoDecorate","_dataSetter","dataStore","_push","types","endpoint","getEndpoint","getVisitorUrlData","getOptionParams","eventName","urlParam","contextData","JSON","stringify","scriptUrl","identify","getItem","getProtocol","protocol","path","Error","thirdPartyPath","max","min","visit","funcName","track","hash","eventData","_cb","getPageUrl","getPageTitle","getDomainName","uri","getURI","getPageHash","startPing","trackForm","els","bindEl","ev","props","opts","_this3","trackFormHandler","trackFinished","getAttribute","personData","noSubmit","preventDefault","stopPropagation","setAttribute","submit","trackClick","properties","_this4","trackClickHandler","noNav","click","pingInterval","setInterval","_this5","ping","stopPing","clearInterval","now","sleep","xdm","canDecorate","decorated","decorate","reset","removeItem","query","pathname","host","search","charAt","port","undecorate","_url","getElementsByTagName","innerHTML","matches","match","o","project","instance","meta","screen","width","height","language","navigator","browserLanguage","app","referer","referrer","_warn","ip","dispose","fire","WoopraTracker","WoopraLoadScript","cElem","srcElement","target","tagName","toLowerCase","_download","exports","woopraLoaded","_queue","woopraTracker"],"mappings":"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"}